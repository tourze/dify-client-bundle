# 获取会话历史消息

> 滚动加载形式返回历史聊天记录，第一页返回最新 `limit` 条，即倒序返回。

## OpenAPI

````yaml zh-hans/openapi_chatflow.json get /messages
paths:
  path: /messages
  method: get
  servers:
    - url: '{api_base_url}'
      description: API 的基础 URL。请将 {api_base_url} 替换为您的应用提供的实际 API 基础 URL。
      variables:
        api_base_url:
          type: string
          description: 实际的 API 基础 URL
          default: https://api.dify.ai/v1
  request:
    security:
      - title: ApiKeyAuth
        parameters:
          query: {}
          header:
            Authorization:
              type: http
              scheme: bearer
              description: >-
                API-Key 鉴权。所有 API 请求都应在 Authorization HTTP Header 中包含您的
                API-Key，格式为：Bearer {API_KEY}。强烈建议开发者把 API-Key 放在后端存储，而非客户端，以免泄露。
          cookie: {}
    parameters:
      path: {}
      query:
        conversation_id:
          schema:
            - type: string
              required: true
              description: 会话 ID。
              format: uuid
        user:
          schema:
            - type: string
              required: true
              description: >-
                用户标识，由开发者定义规则，需保证用户标识在应用内唯一。**重要说明**: Service API 不共享 WebApp
                创建的对话。通过 API 创建的对话与 WebApp 界面中创建的对话是相互隔离的。
        first_id:
          schema:
            - type: string
              description: 当前页第一条聊天记录的 ID，默认 null。
              format: uuid
            - type: 'null'
              description: 当前页第一条聊天记录的 ID，默认 null。
        limit:
          schema:
            - type: integer
              description: 一次请求返回多少条记录，默认 20 条。
              default: 20
      header: {}
      cookie: {}
    body: {}
  response:
    '200':
      application/json:
        schemaArray:
          - type: object
            properties:
              limit:
                allOf:
                  - type: integer
                    description: 返回条数。
              has_more:
                allOf:
                  - type: boolean
                    description: 是否存在下一页。
              data:
                allOf:
                  - type: array
                    items:
                      $ref: '#/components/schemas/ConversationMessageItemCn'
                    description: 消息列表。
            refIdentifier: '#/components/schemas/ConversationHistoryResponseCn'
        examples:
          example:
            value:
              limit: 123
              has_more: true
              data:
                - id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                  conversation_id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                  inputs: {}
                  query: <string>
                  answer: <string>
                  message_files:
                    - id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                      type: <string>
                      url: <string>
                      belongs_to: user
                  feedback:
                    rating: like
                  retriever_resources:
                    - position: 123
                      dataset_id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                      dataset_name: <string>
                      document_id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                      document_name: <string>
                      segment_id: 3c90c3cc-0d44-4b50-8888-8dd25736052a
                      score: 123
                      content: <string>
                  created_at: 123
        description: 成功获取会话历史消息。
  deprecated: false
  type: path
components:
  schemas:
    RetrieverResourceCn:
      type: object
      description: 引用和归属分段信息。
      properties:
        position:
          type: integer
        dataset_id:
          type: string
          format: uuid
        dataset_name:
          type: string
        document_id:
          type: string
          format: uuid
        document_name:
          type: string
        segment_id:
          type: string
          format: uuid
        score:
          type: number
          format: float
        content:
          type: string
    ConversationMessageItemCn:
      type: object
      description: 会话中的单条消息。
      properties:
        id:
          type: string
          format: uuid
          description: 消息 ID。
        conversation_id:
          type: string
          format: uuid
          description: 会话 ID。
        inputs:
          type: object
          additionalProperties: true
          description: 用户输入参数。
        query:
          type: string
          description: 用户输入/提问内容。
        answer:
          type: string
          description: 回答消息内容。
        message_files:
          type: array
          items:
            $ref: '#/components/schemas/MessageFileItemCn'
          description: 消息文件列表。
        feedback:
          type: object
          nullable: true
          properties:
            rating:
              type: string
              enum:
                - like
                - dislike
              description: 点赞 'like' / 点踩 'dislike'。
          description: 反馈信息。
        retriever_resources:
          type: array
          items:
            $ref: '#/components/schemas/RetrieverResourceCn'
          description: 引用和归属分段列表。
        created_at:
          type: integer
          format: int64
          description: 创建时间。
    MessageFileItemCn:
      type: object
      description: 消息中的文件项。
      properties:
        id:
          type: string
          format: uuid
          description: ID。
        type:
          type: string
          description: 文件类型，例如 'image'。
        url:
          type: string
          format: url
          description: 预览图片地址。
        belongs_to:
          type: string
          enum:
            - user
            - assistant
          description: 文件归属方。

````